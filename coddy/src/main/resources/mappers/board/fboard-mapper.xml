<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="fboardMapper">


	<!-- FBOARD resultMap -->
	<resultMap id="fboardResultSet" type="fboard">
	    <result column="FBOARD_NO" property="fboardNo"/>
	    <result column="FBOARD_TITLE" property="fboardTitle"/>
	    <result column="FBOARD_CONTENT" property="fboardContent"/>
	    <result column="FBOARD_WRITER" property="fboardWriter"/>
	    <result column="FBOARD_INSERT" property="fboardInsert"/>
	    <result column="FBOARD_UPDATE" property="fboardUpdate"/>
	    <result column="FBOARD_DELETE" property="fboardDelete"/>
	    <result column="FBOARD_ORIGIN" property="fboardorigin" />
	    <result column="FBOARD_CHANGE" property="fboardchange" />
	    <result column="FBOARD_VIEWS" property="fboardViews"/>
	</resultMap>
	
	<!-- FREPLY resultMap -->
	<resultMap id="freplyResultSet" type="freply">
	    <result column="REPLY_NO" property="freplyNo"/>
	    <result column="MEMBER_NO" property="memberNo"/>
	    <result column="FBOARD_NO" property="fboardNo"/>
	    <result column="FREPLY_PARENT" property="freplyParent"/>
	    <result column="FREPLY_CONTENT" property="freplyContent"/>
	    <result column="FREPLY_INSERT" property="freplyInsert"/>
	    <result column="FREPLY_UPDATE" property="freplyUpdate"/>
	    <result column="FREPLY_DELETE" property="freplyDelete"/>
	</resultMap>
	
	<!-- FATTACHMENT resultMap -->
	<resultMap id="fattachmentResultSet" type="fattachment">
	    <result column="FATTACHMENT_NO" property="fattachmentNo"/>
	    <result column="FBOARD_NO" property="fboardNo"/>
	    <result column="FATTACHMENT_ORIGIN" property="fattachmentOrigin"/>
	    <result column="FATTACHMENT_CHANGE" property="fattachmentChange"/>
	    <result column="FATTACHMENT_PATH" property="fattachmentPath"/>
	    <result column="FATTACHMENT_INSERT" property="fattachmentInsert"/>
	    <result column="FATTACHMENT_LEVEL" property="fattachmentLevel"/>
	</resultMap>
	
	<!-- FBOARD insert -->
	<insert id="insertBoard" parameterType="fboard">
	    INSERT INTO FBOARD (FBOARD_NO, 
	    					FBOARD_TITLE, 
	    					FBOARD_CONTENT, 
	    					FBOARD_WRITER, 
	    					FBOARD_INSERT)
	    VALUES (SEQ_FBOARD.NEXTVAL, 
	    		#{fboardTitle}, 
	    		#{fboardContent}, 
	    		#{fboardWriter}, 
	    		SYSDATE)
	</insert>
	
	<!-- FBOARD select -->
	<select id="selectBoard" parameterType="_int" resultMap="fboardResultSet">
	    SELECT F.FBOARD_NO, 
	           F.FBOARD_TITLE,
	           F.FBOARD_CONTENT,
	    	   M.MEMBER_NAME AS "FBOARD_WRITER",
	    	   F.FBOARD_INSERT AS "FBOARD_INSERT"
	    	FROM FBOARD F, MEMBER M 
	       WHERE F.FBOARD_WRITER = M.MEMBER_NO 
	         AND F.FBOARD_NO = #{fboardNo} 
	         AND F.FBOARD_DELETE IS NULL
	</select>
			
	<!-- FBOARD selectListCount -->	
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		  FROM FBOARD 
		 WHERE FBOARD_DELETE IS NULL
	</select>   
	
	<!-- FBOARD selectList -->
	<select id="selectList" resultMap="fboardResultSet">
		SELECT FBOARD_NO
		     , FBOARD_TITLE
		     , M.MEMBER_NAME AS "FBOARD_WRITER"
		     , FBOARD_VIEWS
		     , TO_CHAR(FBOARD_INSERT, 'YYYY-MM-DD') AS "FBOARD_INSERT"
		     , FBOARD_ORIGIN
		  FROM FBOARD F, MEMBER M
		 WHERE F.FBOARD_DELETE IS NULL
		   AND M.MEMBER_NO = F.FBOARD_WRITER
		 ORDER BY FBOARD_NO DESC
	</select>
	
	<update id="increaseCount" parameterType="_int">
		UPDATE FBOARD
		   SET FBOARD_VIEWS = FBOARD_VIEWS + 1
		 WHERE FBOARD_NO = #{fboardNo} AND FBOARD_DELETE IS NULL
	</update> 
	
	<!-- FBOARD update -->
	<update id="updateBoard" parameterType="fboard">
	    UPDATE FBOARD
	    SET FBOARD_TITLE = #{fboardTitle},
	        FBOARD_CONTENT = #{fboardContent},
	        FBOARD_WRITER = #{fboardWriter},
	        FBOARD_UPDATE = SYSDATE,
	        FBOARD_INSERT = #{fboardInsert},
	        FBOARD_DELETE = #{fboardDelete},
	        FBOARD_VIEWS = #{fboardViews}
	    WHERE FBOARD_NO = #{fboardNo} AND FBOARD_DELETE IS NULL
	</update>

	<!-- FBOARD delete -->
	<update id="deleteBoard" parameterType="_int">
	    UPDATE FBOARD 
	       SET FBOARD_DELETE = SYSDATE 
	     WHERE FBOARD_NO = #{fboardNo} 
	       AND FBOARD_DELETE IS NULL
	</update>

	<!-- FREPLY insert -->
	<insert id="insertReply" parameterType="freply">
		INSERT INTO CREPLY(FREPLY_NO
		                , FREPLY_CONTENT
		                , FREF_FNO
		                , FREPLY_WRITER)
		           VALUES(SEQ_RNO.NEXTVAL
		                , #{freplyContent}
		                , #{frefBoardNo}
		                , #{freplyWriter})
	</insert>	
	
	<!-- FREPLY select -->
	
	<!-- FREPLY selectListCount -->
	
	<!-- FREPLY selectList -->
	<select id="selectReplyList" parameterType="_int" resultMap="freplyResultSet">
	    SELECT FREPLY_NO
	         , FREPLY_WRITER
	         , FREPLY_CONTENT
	         , TO_CHAR(FBOARD_INSERT, 'YYYY-MM-DD') AS "FBOARD_INSERT"
	      FROM FREPLY
	     WHERE FREPLY_FNO = #{fboardNo}
	     ORDER BY FREPLY_NO DESC
	</select>
		
	<!-- FREPLY increaseCount -->
	<!-- FBOARD update -->
	<!-- FREPLY delete -->
	
	<insert id="insertBoardImg" parameterType="fattachment">
		INSERT INTO FATTACHMENT(
			FATTACHMENT_NO,
			FBOARD_NO,
			FATTACHMENT_ORIGIN,
			FATTACHMENT_PATH,
			FATTACHMENT_CHANGE,
			FATTACHMENT_LEVEL
		) VALUES (
			SEQ_IATTACHMENT.NEXTVAL,
			SEQ_FBOARD.CURRVAL,
			#{fAttachmentOrigin},
			#{fAttachmentPath},
			#{fAttachmentChange},
			#{fAttachmentLevel}
		)
		
	</insert>	
	
	<select id="selectAttachment" parameterType="fattachment" resultMap="fattachmentResultSet">
     SELECT FATTACHMENT_NO,
            FBOARD_NO, 
            FATTACHMENT_ORIGIN, 
            FATTACHMENT_CHANGE, 
            FATTACHMENT_PATH,
            FATTACHMENT_INSERT, 
            FATTACHMENT_LEVEL 
      FROM FATTACHMENT 
     WHERE FBOARD_NO = #{fboardNo} 
       AND FATTACHMENT_LEVEL = 1
	</select>
	
    <select id="getAttachmentList" parameterType="fattachment" resultMap="fattachmentResultSet">
    SELECT * 
      FROM FATTACHMENT 
     WHERE FBOARD_NO = #{fboardNo} 
       AND FATTACHMENT_LEVEL = 0
    </select>		
		
</mapper>