<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="cboardMapper">

	<resultMap id="creplyResultSet" type="creply">
		<result column="CREPLY_NO" property="creplyNo" />
		<result column="CREPLY_CONTENT" property="creplyContent" />
		<result column="CREPLY_WRITER" property="creplyWriter" />
		<result column="CREATE_DATE" property="createDate" />
	</resultMap>

	<resultMap id="cboardResultSet" type="cboard">
		<result column="CBOARD_NO" property="cboardNo" />
		<result column="CBOARD_TITLE" property="cboardTitle" />
		<result column="CBOARD_WRITER" property="cboardWriter" />
		<result column="CBOARD_INSERT" property="cboardInsert" />
		<result column="CREATE_DATE" property="createDate" /> 
		<result column="ORIGIN_NAME" property="originName" />
		<result column="CBOARD_CONTENT" property="cboardContent" />
		<result column="CHANGE_NAME" property="changeName" />
		<result column="CBOARD_VIEWS" property="cboardViews" />
	</resultMap>

    <insert id="insertBoard" parameterType="cboard">
        INSERT INTO CBOARD (CBOARD_NO, 
        					CBOARD_TITLE,
        					CBOARD_WRITER, 
        					CBOARD_CONTENT,
        					ORIGIN_NAME,
        					CHANGE_NAME)
        VALUES(SEQ_CBOARD.NEXTVAL, 
        		#{cboardTitle}, 
        		#{cboardWriter}, 
        		#{cboardContent},
        		#{originName},
        		#{changeName})
    </insert>
    
	<select id="selectListCount" resultType="int">
		SELECT COUNT(*)
		  FROM CBOARD
	</select>    
	
	<select id="selectList" resultMap="cboardResultSet">
		SELECT CBOARD_NO
		     , CBOARD_TITLE
		     , CBOARD_WRITER
		     , CBOARD_VIEWS
		     , TO_CHAR(CBOARD_INSERT, 'YYYY-MM-DD') AS "CBOARD_INSERT"
		     , ORIGIN_NAME
		  FROM CBOARD
		 ORDER BY CBOARD_NO DESC
	</select>	
    
	<update id="increaseCount" parameterType="int">
		UPDATE CBOARD
		   SET CBOARD_VIEWS = CBOARD_VIEWS + 1
		 WHERE CBOARD_NO = #{cboardNo}
	</update>    
    
	<select id="selectBoard" parameterType="_int" resultMap="cboardResultSet">
		SELECT CBOARD_NO
		     , CBOARD_TITLE
		     , CBOARD_CONTENT
		     , CBOARD_WRITER
		     , TO_CHAR(CBOARD_INSERT, 'YYYY-MM-DD') AS "CBOARD_INSERT"
		     , ORIGIN_NAME
		     , CHANGE_NAME
		  FROM CBOARD
		 WHERE CBOARD_NO = #{cboardNo}
	</select>    
 
	<update id="deleteBoard" parameterType="_int">
		DELETE  
		  FROM CBOARD 
		 WHERE CBOARD_NO = #{cboardNo}
	</update>    
    
	<update id="updateBoard" parameterType="cboard">
		UPDATE CBOARD
		   SET CBOARD_TITLE = #{cboardTitle}
		     , CBOARD_CONTENT = #{cboardContent}
		     , ORIGIN_NAME = #{originName}
		     , CHANGE_NAME = #{changeName}
		 WHERE CBOARD_NO = #{cboardNo}
	</update>
	
	<select id="selectReplyList" parameterType="_int" resultMap="creplyResultSet">
	    SELECT CREPLY_NO
	         , CREPLY_WRITER
	         , CREPLY_CONTENT
	         , TO_CHAR(CBOARD_INSERT, 'YYYY-MM-DD') AS "CBOARD_INSERT"
	      FROM CREPLY
	     WHERE CREPLY_CNO = #{cboardNo}
	     ORDER BY CREPLY_NO DESC
	</select>
	
	<insert id="insertReply" parameterType="creply">
		INSERT INTO CREPLY(CREPLY_NO
		                , CREPLY_CONTENT
		                , CREF_CNO
		                , CREPLY_WRITER)
		           VALUES(SEQ_RNO.NEXTVAL
		                , #{creplyContent}
		                , #{crefBoardNo}
		                , #{creplyWriter})
	</insert>
	
	<select id="selectTopBoardList" resultMap="cboardResultSet">
		SELECT ROWNUM, c.* 
		  FROM (SELECT CBOARD_NO
		             , CBOARD_TITLE
		             , CBOARD_WRITER
		             , ORIGIN_NAME
		             , CBOARD_VIEWS
		             , TO_CHAR(CBOARD_INSERT, 'YYYY-MM-DD') AS "CBOARD_INSERT"
		          FROM CBOARD
		         ORDER BY CBOARD_VIEWS DESC) B
		 WHERE ROWNUM BETWEEN 1 AND 5
	</select>    
 
    
</mapper>